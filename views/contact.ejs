<% layout('layout') -%>

<div class="container-fluid">
	<div class="row-fluid">
		<div class="span2 visible-desktop">
			<div class="well sidebar-nav">
				<ul class="nav nav-list">
					<li><a href="/" title="Blog List">Blog List</a></li>
					<li class="nav-header">
						<% var blogMonth = 0; var monthNames = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ]; %>
						<% if (blog) { %>
							<% for(var i = 0; i < blog.length; i++) { %>
								<% var blogPost = blog[i]; %>
								<% var thisBlogMonth = blogPost.createdDate.getMonth(); %>
								<% if (thisBlogMonth != blogMonth) { blogMonth = thisBlogMonth; %>
									</ul>
									<span>
										<a href="/" title="<%= monthNames[blogMonth] %>"><%= monthNames[blogMonth] %> </a>
										<span class="icon-chevron-down pull-right" data-target="#<%= monthNames[blogMonth] %>" data-toggle="collapse"></span>
									</span>
									<ul class="nav nav-list collapse in" id="<%= monthNames[blogMonth] %>" >
								<% } %>
								<li><a href="/blog/<%= blogPost.id %>" title="<%= blogPost.title %>"><%= blogPost.title %></a></li>
								<% if (i == blog.length) { %>
									</ul>
								<% } %>
							<% } %>
						<% } %>
					</li>
				</ul>
			</div>
		</div>
		<div class="span8">
			<div class="well well-large">
				<form class="form-horizontal" id="emailmeForm">
					<div class="control-group">
						<label for="email">Email:</label>
						<div>
							<input type="text" name="email" id="email" placeholder="Email">
						</div>
					</div>
					<div class="control-group">
						<label for="name">Name:</label>
						<div>
							<input type="text" name="name" id="name" placeholder="Name">
						</div>
					</div>
					<div class="control-group">
						<label for="message">Message:</label>
						<div>
							<textarea name="message" id="message" placeholder="Message" rows="3"></textarea>
						</div>
					</div> 
					<div class="control-group">
						<div>
							<button id="submitButtonId" type="submit" class="btn">Email Me</button>
						</div>
					</div>
				</form>
				<div id="error"></div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function() {
		$("#submitButtonId").click(function() {
			if($('#email').val().length > 1 && $('#name').val().length > 1 && $('#message').val().length > 1) {
				$.ajax({
					type: "POST",
					url: '/emailme',
					data: $("#emailmeForm").serialize(),
					success: function(data) {
						if (data == "OK") {
							//email was made, go to homepage
							window.location = "/";
						};
					}
				});
			} else {
				document.getElementById("error").innerHTML="Fill out all fields!";
			};
			return false;
		});
	});
</script>
